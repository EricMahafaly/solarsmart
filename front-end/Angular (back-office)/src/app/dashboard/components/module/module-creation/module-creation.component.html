<div class="vh-100" *ngIf="loaded">

  <div class="position-sticky sticky-top d-flex align-items-center bg-white justify-content-between py-4 px-5 border-bottom">
    <div class="fs-4 font-extrabold tracking-tight text-capitalize">{{title}}</div>
    <div>
      <button class="bg-secondary-subtle btn rounded-circle" [routerLink]="'/user-space/modules'">
        <i class="fas fa-xmark"></i>
      </button>
    </div>
  </div>

  <div class="container-fluid overflow-y-auto scroll-bar" style="height: calc(100% - 5rem);">
    <form [formGroup]="moduleForm" (ngSubmit)="onSubmit()" >
      <div class="row mt-3">

        <div class="col-xxl order-0 col-sm-12" >
          <div class="card card-custom">
            <div class="card-header">
              <div class="card-title">General</div>
            </div>
            <div class="card-body">
              <div class="mt-3">
                <p class="fw-semibold fs-15 ">
                  <i class="fa fa-circle text-success me-2"></i>
                  <span class=" section-title">Component Info Section:</span>
                </p>
                <div class="composant-section mb-5">

                  <div class="d-flex mb-4" *ngIf="!this.id && !batteryOptions.loading">
                    <div class="search-box me-2">
                      <label class="form-label">Search here to pre-fill the fields below</label>
                      <div class="position-relative">
                        <div #battery class="select-box d-flex align-items-center">
                          <input placeholder="rechercher ici" type="text" [formControl]="searchBattery"
                                 class="search-input search form-control"
                                 (click)="showBattery = true">
                          <div class="input-icon">
                            <i class="fa fa-search"></i>
                          </div>
                          <span>
                          <i class="fa-solid fa-chevron-down"></i>
                        </span>
                        </div>
                        <app-select-generic
                          [parent]="battery"
                          [(show)]="showBattery"
                          (selectChange)="setBatteryForm($event)"
                          [options]="this.batteryOptions.data"
                          [searchControl]="searchBattery"
                        ></app-select-generic>
                      </div>
                    </div>
                  </div>

                  <p class="fw-semibold">Battery Info / <span class="ms-2"><i class="fas fa-chevron-down"></i></span></p>
                  <div class="ms-2" formGroupName="battery">
                    <div class="row mt-2">
                      <div class="col">
                        <label class="form-label p-0">Power:</label>
                        <div class="row">
                          <p-inputNumber
                            styleClass="col-12" inputStyleClass="form-control" formControlName="puissance"
                            suffix="W"
                            [min]="0"
                            placeholder="ex: 50W"
                            [useGrouping]="false"
                            mode="decimal"
                          ></p-inputNumber>
                        </div>
                      </div>
                      <div class="col">
                        <label class="form-label p-0">Voltage:</label>
                        <div class="row">
                          <p-inputNumber
                            styleClass="col-12" inputStyleClass="form-control" formControlName="voltage"
                            suffix="V"
                            [min]="0"
                            placeholder="ex: 30V"
                            [useGrouping]="false"
                            mode="decimal"
                          ></p-inputNumber>
                        </div>
                        <!--                        <input type="text" formControlName="voltage" validation class="form-control">-->
                      </div>
                    </div>
                    <div class="col-5">
                      <label class="form-label p-0">Mark:</label>
                      <input type="text" class="form-control" validation placeholder="ex: " formControlName="marque">
                    </div>
                  </div>
                </div>


                <div class="composant-section mb-5">

                  <div class="d-flex mb-4" *ngIf="!this.id && !panelOptions.loading">
                    <div class="search-box me-2">
                      <label class="form-label">Search here to pre-fill the fields below</label>
                      <div class="position-relative">
                        <div #panel class="select-box d-flex align-items-center">
                          <input placeholder="rechercher ici" type="text"
                                 [formControl]="searchPanel"
                                 class="search-input search form-control"
                                 (click)="showPanel = true">
                          <div class="input-icon">
                            <i class="fa fa-search"></i>
                          </div>
                          <span>
                          <i class="fa-solid fa-chevron-down"></i>
                        </span>
                        </div>
                        <app-select-generic
                          [parent]="panel"
                          [(show)]="showPanel"
                          (selectChange)="setPanelForm($event)"
                          [options]="this.panelOptions.data"
                          [searchControl]="searchPanel"
                        ></app-select-generic>
                      </div>
                    </div>
                  </div>

                  <p class="fw-semibold">Panneau Info /</p>
                  <div class="ms-2" formGroupName="panel">
                    <div class="row mt-2">
                      <div class="col">
                        <label class="form-label p-0">Power:</label>
                        <div class="row">
                          <p-inputNumber
                            styleClass="col-12"
                            inputStyleClass="form-control"
                            formControlName="puissance"
                            suffix="W"
                            [min]="0"
                            placeholder="ex: 50W"
                            [useGrouping]="false"
                            mode="decimal"
                          ></p-inputNumber>
                        </div>
                      </div>
                      <div class="col">
                        <label class="form-label p-0">Voltage:</label>
                        <div class="row">
                          <p-inputNumber
                            styleClass="col-12"
                            inputStyleClass="form-control"
                            formControlName="voltage"
                            suffix="V"
                            [min]="0"
                            placeholder="ex: 30V"
                            [useGrouping]="false"
                            mode="decimal"
                          ></p-inputNumber>
                        </div>
                      </div>
                    </div>
                    <div class="col-5">
                      <label class="form-label p-0">Mark:</label>
                      <input type="text" class="form-control" validation placeholder="ex: " formControlName="marque">
                    </div>
                  </div>
                </div>

                <div class="">
                  <div class="cursor-pointer" (click)="addOtherInfo()">
                    <p>
                      <i class="fa-solid fa-circle-plus text-success"></i>
<!--                      <i class="fa-solid fa-circle-plus text-primary"></i>-->
                      <span class="ms-1">Add more informations</span>
                    </p>
                  </div>
                </div>

              </div>

            </div>
          </div>
        </div>



        <div class="col-4 position-sticky sticky-top order-1" >
          <div class="card card-custom pb-3 pt-2 mb-3">
            <div class="card-header border-0">
              <div class="card-title">
                <p>Qr Code</p>
              </div>
            </div>

            <div class="card-body text-center pt-0">

              <div class="image-input image-input-empty image-input-outline image-input-placeholder mb-3">
                <div class="image-input-wrapper" [style.background-image]="'url('+getQrImage()+')'" >
                </div>
              </div>

              <div class="text-muted small">Scan the Qr code to access details</div>
            </div>
          </div>

        </div>
      </div>

      <div class="row mb-5 mt-2" >
        <ng-container *ngIf="dataForm.othersInfo.length > 0">
          <div class="col-12">
            <div class="card card-custom">
              <div class="card-header">
                <div class="card-title">
                  Additional information
                </div>
              </div>
              <div class="card-body">
                <app-additional-info-list
                  [(data)]="dataForm.othersInfo"
                  [editable]="true"
                  [deletable]="true"
                ></app-additional-info-list>
              </div>
            </div>
          </div>
        </ng-container>
      </div>


      <div class="action-section footer">
        <div class="btn-toolbar fixed-action d-flex align-content-center">
          <button class="btn btn-success ms-3" type="submit" [disabled]="submitted">
          <span class="me-1" *ngIf="submitted">
            <i class="fa-solid fa-spinner fa-spin"></i>
          </span>
            Save
          </button>
          <button [routerLink]="'/user-space/modules'"
                  class="btn bg-secondary-subtle ms-2">
            Cancel
          </button>
        </div>
      </div>

    </form>
  </div>
</div>
